 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Hadrami Packet Tracker - RAK Network Learning Portal</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="auth.css">
</head>
<body>
    <!-- Authentication will be handled by auth.js -->
    <div class="app-container" id="mainApp" style="display: none;">
        <!-- Title Bar -->
        <div class="title-bar">
            <span class="title-text">IT Hadrami</span>
            <span class="title-file" id="projectFileName">Untitled.pkt</span>
        </div>

        <!-- Menu Bar -->
        <div class="menu-bar">
            <div class="menu-item" data-menu="file">File</div>
            <div class="menu-item" data-menu="edit">Edit</div>
            <div class="menu-item" data-menu="options">Options</div>
            <div class="menu-item" data-menu="view">View</div>
            <div class="menu-item" data-menu="tools">Tools</div>
            <div class="menu-item" data-menu="extensions">Extensions</div>
            <div class="menu-item" data-menu="window">Window</div>
            <div class="menu-item" data-menu="help">Help</div>
        </div>

        <!-- Toolbar -->
        <div class="main-toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" id="toolbarSave" title="Save">ğŸ’¾</button>
                <button class="toolbar-btn" id="toolbarPrint" title="Print">ğŸ–¨ï¸</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" id="toolbarCopy" title="Copy">ğŸ“‹</button>
                <button class="toolbar-btn" id="toolbarPaste" title="Paste">ğŸ“„</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" id="toolbarUndo" title="Undo">â†¶</button>
                <button class="toolbar-btn" id="toolbarRedo" title="Redo">â†·</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" id="toolbarZoomIn" title="Zoom In">ğŸ”+</button>
                <button class="toolbar-btn" id="toolbarZoomOut" title="Zoom Out">ğŸ”-</button>
                <button class="toolbar-btn" id="toolbarZoomFit" title="Zoom Fit">ğŸ”</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn active" id="toolbarSelect" title="Select">ğŸ‘†</button>
                <button class="toolbar-btn" id="toolbarMove" title="Move">âœ‹</button>
                <button class="toolbar-btn" id="toolbarInspect" title="Inspect">ğŸ”</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" id="toolbarDelete" title="Delete">ğŸ—‘ï¸</button>
                <button class="toolbar-btn" id="toolbarNote" title="Add Note">ğŸ“</button>
                <button class="toolbar-btn" id="toolbarDrawLine" title="Draw Line">ğŸ“</button>
                <button class="toolbar-btn" id="toolbarPDU" title="Create PDU">ğŸ“¦</button>
            </div>
        </div>

        <!-- View Tabs -->
        <div class="view-tabs">
            <button class="view-tab active" data-view="logical">Logical</button>
            <button class="view-tab" data-view="physical">Physical</button>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Device Palette Sidebar -->
            <aside class="device-palette">
                <h2>Network Devices</h2>
                <div class="device-category">
                    <h3>Routers</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="router" data-device="router-2901">
                            <div class="device-icon router-icon">ğŸ”„</div>
                            <span>Router 2901</span>
                        </div>
                        <div class="device-item" data-type="router" data-device="router-1941">
                            <div class="device-icon router-icon">ğŸ”„</div>
                            <span>Router 1941</span>
                        </div>
                        <div class="device-item" data-type="router" data-device="router-asr">
                            <div class="device-icon router-icon">ğŸ”„</div>
                            <span>ASR Router</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>Switches</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="switch" data-device="switch-2960">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>Switch 2960</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-3750">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>Switch 3750</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-l3">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>Layer 3 Switch</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-tplink-omada-tl-sg2210mp">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>TP-Link Omada TL-SG2210MP</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-tplink-omada-tl-sg3428x">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>TP-Link Omada TL-SG3428X</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-tplink-omada-tl-sg2428p">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>TP-Link Omada TL-SG2428P</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-tplink-omada-tl-sg105e">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>TP-Link Omada TL-SG105E</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="switch-tplink-omada-tl-sg2218">
                            <div class="device-icon switch-icon">ğŸ”€</div>
                            <span>TP-Link Omada TL-SG2218</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>End Devices</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="pc" data-device="pc">
                            <div class="device-icon pc-icon">ğŸ’»</div>
                            <span>PC</span>
                        </div>
                        <div class="device-item" data-type="server" data-device="server">
                            <div class="device-icon server-icon">ğŸ–¥ï¸</div>
                            <span>Server</span>
                        </div>
                        <div class="device-item" data-type="laptop" data-device="laptop">
                            <div class="device-icon laptop-icon">ğŸ“±</div>
                            <span>Laptop</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>VoIP & Telephony</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="ipbx" data-device="ipbx-server">
                            <div class="device-icon ipbx-icon">ğŸ“</div>
                            <span>IPBX Server</span>
                        </div>
                        <div class="device-item" data-type="ipphone" data-device="ip-phone">
                            <div class="device-icon ipphone-icon">â˜ï¸</div>
                            <span>IP Phone</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>Infrastructure</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="wireless" data-device="wireless-ap">
                            <div class="device-icon wireless-icon">ğŸ“¡</div>
                            <span>Wireless AP</span>
                        </div>
                        <div class="device-item" data-type="firewall" data-device="firewall">
                            <div class="device-icon firewall-icon">ğŸ›¡ï¸</div>
                            <span>Firewall</span>
                        </div>
                        <div class="device-item" data-type="cloud" data-device="cloud">
                            <div class="device-icon cloud-icon">â˜ï¸</div>
                            <span>Cloud</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>Cisco Devices</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="router" data-device="cisco-1941">
                            <div class="device-icon cisco-router-icon">ğŸ”„</div>
                            <span>Cisco 1941 Router</span>
                        </div>
                        <div class="device-item" data-type="router" data-device="cisco-2901">
                            <div class="device-icon cisco-router-icon">ğŸ”„</div>
                            <span>Cisco 2901 Router</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="cisco-2960">
                            <div class="device-icon cisco-switch-icon">ğŸ”€</div>
                            <span>Cisco 2960 Switch</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="cisco-3750">
                            <div class="device-icon cisco-switch-icon">ğŸ”€</div>
                            <span>Cisco 3750 Switch</span>
                        </div>
                        <div class="device-item" data-type="switch" data-device="cisco-3560">
                            <div class="device-icon cisco-switch-icon">ğŸ”€</div>
                            <span>Cisco 3560 Switch</span>
                        </div>
                        <div class="device-item" data-type="wireless" data-device="cisco-wap">
                            <div class="device-icon cisco-wireless-icon">ğŸ“¡</div>
                            <span>Cisco WAP</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>Dahua Devices</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="dahua" data-device="dahua-nvr">
                            <div class="device-icon dahua-icon">ğŸ“¹</div>
                            <span>Dahua NVR</span>
                        </div>
                        <div class="device-item" data-type="dahua" data-device="dahua-ipcamera">
                            <div class="device-icon dahua-icon">ğŸ“·</div>
                            <span>Dahua IP Camera</span>
                        </div>
                        <div class="device-item" data-type="dahua" data-device="dahua-dvr">
                            <div class="device-icon dahua-icon">ğŸ“¼</div>
                            <span>Dahua DVR</span>
                        </div>
                        <div class="device-item" data-type="dahua" data-device="dahua-encoder">
                            <div class="device-icon dahua-icon">ğŸ“º</div>
                            <span>Dahua Encoder</span>
                        </div>
                        <div class="device-item" data-type="dahua" data-device="dahua-decoder">
                            <div class="device-icon dahua-icon">ğŸ“º</div>
                            <span>Dahua Decoder</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>Cables & Connections</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="cable" data-device="straight-through">
                            <div class="device-icon cable-icon">â”€</div>
                            <span>Straight-Through</span>
                        </div>
                        <div class="device-item" data-type="cable" data-device="crossover">
                            <div class="device-icon cable-icon">âœ•</div>
                            <span>Crossover</span>
                        </div>
                        <div class="device-item" data-type="cable" data-device="fiber">
                            <div class="device-icon cable-icon">ğŸ’</div>
                            <span>Fiber Optic</span>
                        </div>
                        <div class="device-item" data-type="cable" data-device="console">
                            <div class="device-icon cable-icon">ğŸ–¥ï¸</div>
                            <span>Console Cable</span>
                        </div>
                        <div class="device-item" data-type="cable" data-device="serial">
                            <div class="device-icon cable-icon">ğŸ“¡</div>
                            <span>Serial Cable</span>
                        </div>
                    </div>
                </div>

                <div class="device-category">
                    <h3>Engineering Structures</h3>
                    <div class="device-items">
                        <div class="device-item" data-type="facade" data-device="distribution-center">
                            <div class="device-icon facade-icon">ğŸ­</div>
                            <span>Distribution Center</span>
                        </div>
                        <div class="device-item" data-type="facade" data-device="data-center">
                            <div class="device-icon facade-icon">ğŸ¢</div>
                            <span>Data Center</span>
                        </div>
                        <div class="device-item" data-type="facade" data-device="network-hub">
                            <div class="device-icon facade-icon">ğŸ”Œ</div>
                            <span>Network Hub</span>
                        </div>
                        <div class="device-item" data-type="facade" data-device="tower">
                            <div class="device-icon facade-icon">ğŸ“¶</div>
                            <span>Communication Tower</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <main class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="toolbar-group">
                        <button id="selectMode" class="tool-btn active" data-mode="select">ğŸ” Select</button>
                        <button id="connectMode" class="tool-btn" data-mode="connect">ğŸ”— Connect</button>
                        <button id="deleteMode" class="tool-btn" data-mode="delete">ğŸ—‘ï¸ Delete</button>
                    </div>
                    <div class="toolbar-group">
                        <span>Zoom: </span>
                        <button id="zoomIn" class="tool-btn">â•</button>
                        <button id="zoomOut" class="tool-btn">â–</button>
                        <button id="resetZoom" class="tool-btn">ğŸ” Reset</button>
                    </div>
                    <div class="toolbar-group">
                        <span>Department:</span>
                        <select id="departmentSelect">
                            <option value="all-system">All-System</option>
                            <option value="multi-device">Multi-Device</option>
                            <option value="electronics">Electronics Distribution</option>
                            <option value="network">Network Infrastructure</option>
                        </select>
                    </div>
                </div>
                <div class="canvas-container">
                    <div class="portal-background">
                        <canvas id="animatedBackground" class="animated-bg"></canvas>
                    </div>
                    <div id="networkCanvas" class="canvas"></div>
                    <svg id="connectionOverlay" class="connection-overlay"></svg>
                </div>
            </main>

            <!-- Properties/Script Panel -->
            <aside class="properties-panel">
                <div class="panel-tabs">
                    <button class="tab-btn active" data-tab="properties">Properties</button>
                    <button class="tab-btn" data-tab="cli">CLI Terminal</button>
                    <button class="tab-btn" data-tab="hardware">Hardware View</button>
                    <button class="tab-btn" data-tab="script">Generated Script</button>
                    <button class="tab-btn" data-tab="connections">Connections</button>
                </div>

                <div id="propertiesTab" class="tab-content active">
                    <h3>Device Properties</h3>
                    <div id="deviceProperties" class="properties-content">
                        <p class="placeholder">Select a device to configure</p>
                    </div>
                </div>

                <div id="scriptTab" class="tab-content">
                    <h3>Generated Configuration Script</h3>
                    <div class="script-toolbar">
                        <button id="copyScript" class="btn btn-small">Copy</button>
                        <button id="downloadScript" class="btn btn-small">Download</button>
                        <select id="scriptFormat">
                            <option value="cisco">Cisco IOS</option>
                            <option value="junos">Juniper JunOS</option>
                            <option value="json">JSON</option>
                            <option value="yaml">YAML</option>
                        </select>
                    </div>
                    <pre id="generatedScript" class="script-output"><code>No script generated yet. Add devices and configure them.</code></pre>
                </div>

                <div id="connectionsTab" class="tab-content">
                    <h3>Network Connections</h3>
                    <div id="connectionsList" class="connections-content">
                        <p class="placeholder">No connections yet</p>
                    </div>
                </div>

                <div id="cliTab" class="tab-content">
                    <h3>CLI Terminal</h3>
                    <div class="cli-container">
                        <div id="cliOutput" class="cli-output"></div>
                        <div class="cli-input-container">
                            <span class="cli-prompt" id="cliPrompt">Device#</span>
                            <input type="text" id="cliInput" class="cli-input" autocomplete="off" spellcheck="false">
                        </div>
                        <button id="clearCli" class="btn btn-small" style="margin-top: 0.5rem;">Clear Terminal</button>
                    </div>
                </div>

                <div id="hardwareTab" class="tab-content">
                    <h3>Hardware View</h3>
                    <div id="hardwareView" class="hardware-view">
                        <p class="placeholder">Select a device to view hardware details</p>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Command Cheat Sheet Sidebar -->
    <aside id="cheatSheet" class="cheat-sheet">
        <div class="cheat-sheet-header">
            <h3>Command Cheat Sheet</h3>
            <button id="toggleCheatSheet" class="btn-icon">Ã—</button>
        </div>
        <div class="cheat-sheet-content">
            <div class="cheat-section">
                <h4>Basic Commands</h4>
                <div class="cheat-item">
                    <code>enable</code>
                    <span>Enter privileged mode</span>
                </div>
                <div class="cheat-item">
                    <code>conf t</code>
                    <span>Enter configuration mode</span>
                </div>
                <div class="cheat-item">
                    <code>exit</code>
                    <span>Exit current mode</span>
                </div>
            </div>
            <div class="cheat-section">
                <h4>VLAN Commands</h4>
                <div class="cheat-item">
                    <code>vlan [id]</code>
                    <span>Create/configure VLAN</span>
                </div>
                <div class="cheat-item">
                    <code>name [name]</code>
                    <span>Name the VLAN</span>
                </div>
            </div>
            <div class="cheat-section">
                <h4>Interface Commands</h4>
                <div class="cheat-item">
                    <code>interface [type]</code>
                    <span>Configure interface</span>
                </div>
                <div class="cheat-item">
                    <code>ip add [ip] [mask]</code>
                    <span>Set IP address</span>
                </div>
                <div class="cheat-item">
                    <code>no shutdown</code>
                    <span>Enable interface</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Instructional Modal -->
    <div id="instructionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Device Information</h2>
                <button id="closeModal" class="btn-icon">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be dynamically inserted -->
            </div>
        </div>
    </div>

    <!-- Community Chat Window -->
    <div id="communityChatModal" class="modal community-modal">
        <div class="modal-content community-content">
            <div class="modal-header">
                <h2>ğŸ‘¥ IT Hadrami Community</h2>
                <button id="closeCommunityChat" class="btn-icon">Ã—</button>
            </div>
            <div class="modal-body community-body">
                <div class="community-messages" id="communityMessages">
                    <div class="community-message system">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">System</span>
                                <span class="message-time">Just now</span>
                            </div>
                            <div class="message-text">Welcome to IT Hadrami Community! Share your thoughts, ask questions, and help others.</div>
                        </div>
                    </div>
                </div>
                <div class="community-input-area">
                    <input type="text" id="communityInput" placeholder="Type your message here..." class="community-input">
                    <button id="communitySendBtn" class="btn btn-primary">Send</button>
                </div>
                <div class="community-info">
                    <p>ğŸ’¬ Messages are stored locally. To contact the community directly, use the WhatsApp button.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Comprehensive Educational Window -->
    <div id="educationWindow" class="modal education-modal">
        <div class="modal-content education-content">
            <div class="modal-header">
                <h2>ğŸ“š IT Hadrami Learning Center</h2>
                <button id="closeEducationWindow" class="btn-icon">Ã—</button>
            </div>
            <div class="modal-body education-body">
                <div class="education-tabs">
                    <button class="edu-tab active" data-tab="devices">Devices</button>
                    <button class="edu-tab" data-tab="cables">Cables</button>
                    <button class="edu-tab" data-tab="commands">Commands</button>
                    <button class="edu-tab" data-tab="programming">Programming</button>
                    <button class="edu-tab" data-tab="ai-help">ğŸ¤– AI Assistant</button>
                </div>
                
                <div class="education-content-area">
                    <!-- Devices Tab -->
                    <div id="edu-devices" class="edu-tab-content active">
                        <div class="device-education-grid">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Cables Tab -->
                    <div id="edu-cables" class="edu-tab-content">
                        <div class="cable-education-grid">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Commands Tab -->
                    <div id="edu-commands" class="edu-tab-content">
                        <div class="command-education-content">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Programming Tab -->
                    <div id="edu-programming" class="edu-tab-content">
                        <div class="programming-education-content">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- AI Assistant Tab -->
                    <div id="edu-ai-help" class="edu-tab-content">
                        <div class="ai-education-content">
                            <div class="ai-chat-container">
                                <div id="aiEducationMessages" class="ai-messages"></div>
                                <div class="ai-input-container">
                                    <input type="text" id="aiEducationInput" placeholder="Ask me anything about networking, devices, cables, or commands..." class="ai-input">
                                    <button id="aiEducationSend" class="btn btn-primary">Send</button>
                                </div>
                                <div class="ai-suggestions">
                                    <button class="ai-suggestion-btn" data-query="What is a router and how does it work?">What is a router?</button>
                                    <button class="ai-suggestion-btn" data-query="Explain VLAN configuration">VLAN Configuration</button>
                                    <button class="ai-suggestion-btn" data-query="How to configure IP address on a router?">IP Configuration</button>
                                    <button class="ai-suggestion-btn" data-query="What is the difference between straight-through and crossover cables?">Cable Types</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Button -->
    <button id="helpButton" class="help-button" title="Show Help">?</button>
    <button id="toggleCheatSheetBtn" class="cheat-sheet-toggle" title="Toggle Cheat Sheet">ğŸ“‹</button>

    <!-- Connection Line Overlay -->
    <svg id="connectionOverlay" class="connection-overlay"></svg>
    </div>

        <!-- Simulation Control Panel (Bottom) -->
        <div class="simulation-panel" id="simulationPanel">
            <div class="simulation-left">
                <div class="simulation-time">
                    <span>Time: </span>
                    <span id="simulationTime">00:00:00.000</span>
                </div>
                <div class="play-controls">
                    <button class="play-btn" id="simRewind" title="Rewind">â®</button>
                    <button class="play-btn active" id="simPlayPause" title="Play/Pause">â¸</button>
                    <button class="play-btn" id="simForward" title="Fast Forward">â­</button>
                </div>
                <div class="connection-types">
                    <button class="conn-type-btn active" data-cable="auto" title="Auto Choose Connection Type">ğŸ”Œ</button>
                    <button class="conn-type-btn" data-cable="straight" title="Straight-Through Cable">â”€</button>
                    <button class="conn-type-btn" data-cable="cross" title="Crossover Cable">âœ•</button>
                    <button class="conn-type-btn" data-cable="fiber" title="Fiber Optic">ğŸ’</button>
                    <button class="conn-type-btn" data-cable="console" title="Console Cable">ğŸ–¥ï¸</button>
                    <button class="conn-type-btn" data-cable="serial" title="Serial Cable">ğŸ“¡</button>
                </div>
            </div>
            <div class="simulation-right">
                <button class="sim-btn" id="eventListBtn">Event List</button>
                <button class="sim-btn active" id="realtimeBtn">Realtime</button>
                <button class="sim-btn" id="simulationBtn">Simulation</button>
                <div class="scenario-controls">
                    <span>Scenario 0</span>
                    <button class="sim-btn-small" id="newScenario">New</button>
                    <button class="sim-btn-small" id="deleteScenario">Delete</button>
                </div>
                <button class="sim-btn" id="togglePDUList">Toggle PDU List Window</button>
                <button class="sim-btn" id="showEducationWindow">ğŸ“š Learning</button>
                <button class="sim-btn whatsapp-btn" id="whatsappBtn" title="Contact via WhatsApp">ğŸ’¬ WhatsApp</button>
                <button class="sim-btn" id="communityChatBtn" title="Community Chat">ğŸ‘¥ Community</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer" id="appFooter" style="display: none;">
        <div class="footer-content">
            <div class="footer-brand">
                <div class="footer-logo-container">
                    <img id="footerLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%232563eb'/%3E%3Ctext x='50' y='60' text-anchor='middle' fill='white' font-size='30' font-weight='bold'%3EIT%3C/text%3E%3C/svg%3E" alt="IT Hadrami Logo" class="footer-logo">
                    <input type="file" id="logoUpload" accept="image/*" style="display: none;">
                    <button id="changeLogoBtn" class="btn-icon-small" title="Change Logo">ğŸ“·</button>
                </div>
                <div class="footer-info">
                    <h4>IT Hadrami Packet Tracker</h4>
                    <p>RAK Network Learning Portal</p>
                    <p class="footer-creator">Created by IT HADRAMI</p>
                </div>
            </div>
            <div class="footer-actions">
                <button id="exportPDF" class="btn btn-primary">Export as PDF</button>
                <button id="logoutBtn" class="btn btn-secondary">Logout</button>
            </div>
        </div>
    </footer>

    <script src="auth.js"></script>
    <script src="device-icons.js"></script>
    <script src="device-images.js"></script>
    <script src="cli-engine.js"></script>
    <script src="ai-assistant.js"></script>
    <script src="script.js"></script>
    <script>
        // Initialize auth system
        let authSystem;
        let aiAssistant;
        
        // Wait for DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
        
        function setupAppHandlers() {
            // Logout handler
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    if (authSystem) authSystem.logout();
                });
            }
            
            // Logo upload handler
            const changeLogoBtn = document.getElementById('changeLogoBtn');
            const logoUpload = document.getElementById('logoUpload');
            
            if (changeLogoBtn && logoUpload) {
                changeLogoBtn.addEventListener('click', () => {
                    logoUpload.click();
                });
                
                logoUpload.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const logoImg = document.getElementById('footerLogo');
                            if (logoImg) {
                                logoImg.src = event.target.result;
                                localStorage.setItem('hadrami_logo', event.target.result);
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Load saved logo
            const savedLogo = localStorage.getItem('hadrami_logo');
            if (savedLogo) {
                const logoImg = document.getElementById('footerLogo');
                if (logoImg) logoImg.src = savedLogo;
            }
            
            // PDF Export
            const exportPDFBtn = document.getElementById('exportPDF');
            if (exportPDFBtn) {
                exportPDFBtn.addEventListener('click', () => {
                    if (window.networkBuilder) {
                        window.networkBuilder.exportAsPDF();
                    }
                });
            }
        }
        
        function initApp() {
            // Initialize auth system first
            authSystem = new AuthSystem();
            window.authSystem = authSystem;
            
            // If user is already logged in, setup handlers immediately
            if (authSystem.currentUser) {
                // Main app should already be shown by AuthSystem.init()
                setTimeout(() => {
                    setupAppHandlers();
                    // Also ensure initialization happens
                    if (typeof window.initializeApplication === 'function' && !window.networkBuilder) {
                        window.initializeApplication();
                    }
                }, 500);
            } else {
                // Intercept showMainApp to setup handlers when user logs in
                const originalShowMainApp = authSystem.showMainApp.bind(authSystem);
                authSystem.showMainApp = function() {
                    originalShowMainApp();
                    setTimeout(() => {
                        setupAppHandlers();
                    }, 600);
                };
            }
        }
    </script>
</body>
</html>

